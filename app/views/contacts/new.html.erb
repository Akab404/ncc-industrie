<div class="container">
  <h1>Contactez-nous</h1>
  <div class="global-form" data-controller="form">
    <%= simple_form_for @contact do |f| %>
      <div class="form-inputs mt-4">
        <div class="col-8 col-lg-6">
          <%= f.input :name,
                  required: true,
                  label:"Votre Nom",
                  autofocus: true,
                  error: "Veuillez remplir ce champ" %>
          <%= f.input :email,
                  required: true,
                  label:"Votre Email",
                  autofocus: true,
                  input_html: { autocomplete: "email" },
                  error: "Veuillez vérifier votre email" %>
        </div>
        <div class="col-10">
          <%= f.input :message,
                  :as => :text,
                  :input_html => { 'rows' => 10},
                  required: true,
                  autofocus: true,
                  error: "Veuillez renseigner un message s'il vous plait" %>
          <div class= "d-none">
            <%= f.text_field :nickname, :hint => 'Leave this field blank!' %>
          </div>
        </div>
          <div class="">
            <!-- Paragraphe affichant l'adresse en cas de pépin -->
            <p id="contact-fallback">
              En cas de difficultées, vous pouvez nous envoyer un mail en passant ici&nbsp;:
              <span id="contact-mail">…</span>
            </p>

            <noscript>
              <p>
                En cas de difficultées, vous pouvez nous envoyer un mail en passant ici&nbsp;: contact [at] ncc-industrie [dot] com
              </p>
            </noscript>
          </div>
          <%= recaptcha_tags %>
          <%= f.submit 'Envoyer le message',
          class: 'btn ncc-cta mt-3' %>
        </div>
      </div>
    <% end %>
  </div>
</div>

<script>
  // email parts (modifie seulement ces valeurs si besoin)
  (function(){
    const user = "contact";
    const domain = "ncc-industrie.com";
    const email = user + "@" + domain;

    // texte affiché (facultatif : transforme pour l'humain)
    const humanText = `${user}@${domain}`;

    // attributs mailto (optionnel : ajoute sujet ou corps par défaut)
    const subject = encodeURIComponent("Demande depuis le site");
    const body = encodeURIComponent("Bonjour,\n\nJe vous contacte au sujet de…\n");
    const mailto = `mailto:${email}?subject=${subject}&body=${body}`;

    // création du lien et insertion dans le DOM
    const a = document.createElement("a");
    a.href = mailto;
    a.textContent = humanText;
    a.rel = "noopener noreferrer";
    a.setAttribute("aria-label", "Envoyer un email à " + humanText);

    const target = document.getElementById("contact-mail");
    if (target) {
      target.textContent = " "; // espace propre avant le lien
      target.appendChild(a);
    }
  })();
</script>
